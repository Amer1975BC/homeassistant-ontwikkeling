  - sensor:
      - name: "Stroomprijs Min Vandaag"
        unique_id: min_electricity_price_today
        unit_of_measurement: "EUR/kWh"
        state_class: total
        device_class: monetary
        icon: mdi:arrow-down-bold
        state: >
          {% set prices = [] %}
          {% set current_price = states('sensor.zonneplan_current_electricity_tariff')|float(0) %}
          {% set prices = prices + [current_price] %}
          
          {% for i in range(1, 9) %}
            {% set sensor_name = 'sensor.zonneplan_forecast_tariff_hour_' ~ i %}
            {% if states(sensor_name) != 'unknown' and states(sensor_name) != 'unavailable' %}
              {% set prices = prices + [states(sensor_name)|float(0)] %}
            {% endif %}
          {% endfor %}
          
          {% if prices|length > 0 %}
            {{ prices|min|round(4) }}
          {% else %}
            0
          {% endif %}
            
      - name: "Stroomprijs Max Vandaag"
        unique_id: max_electricity_price_today
        unit_of_measurement: "EUR/kWh"
        state_class: total
        device_class: monetary
        icon: mdi:arrow-up-bold
        state: >
          {% set prices = [] %}
          {% set current_price = states('sensor.zonneplan_current_electricity_tariff')|float(0) %}
          {% set prices = prices + [current_price] %}
          
          {% for i in range(1, 9) %}
            {% set sensor_name = 'sensor.zonneplan_forecast_tariff_hour_' ~ i %}
            {% if states(sensor_name) != 'unknown' and states(sensor_name) != 'unavailable' %}
              {% set prices = prices + [states(sensor_name)|float(0)] %}
            {% endif %}
          {% endfor %}
          
          {% if prices|length > 0 %}
            {{ prices|max|round(4) }}
          {% else %}
            0
          {% endif %}
      
      - name: "Stroomprijs Gemiddeld Vandaag"
        unique_id: avg_electricity_price_today
        unit_of_measurement: "EUR/kWh"
        state_class: total
        device_class: monetary
        icon: mdi:chart-line
        state: >
          {% set prices = [] %}
          {% set current_price = states('sensor.zonneplan_current_electricity_tariff')|float(0) %}
          {% set prices = prices + [current_price] %}
          
          {% for i in range(1, 9) %}
            {% set sensor_name = 'sensor.zonneplan_forecast_tariff_hour_' ~ i %}
            {% if states(sensor_name) != 'unknown' and states(sensor_name) != 'unavailable' %}
              {% set prices = prices + [states(sensor_name)|float(0)] %}
            {% endif %}
          {% endfor %}
          
          {% if prices|length > 0 %}
            {{ (prices|sum / prices|length)|round(4) }}
          {% else %}
            0
          {% endif %}
          
      - name: "Stroomprijs Histogram"
        unique_id: stroomprijs_histogram
        icon: mdi:chart-histogram
        state: >
          {% set prices = [] %}
          {% set current_price = states('sensor.zonneplan_current_electricity_tariff')|float(0) %}
          {% set prices = prices + [current_price] %}
          
          {% for i in range(1, 9) %}
            {% set sensor_name = 'sensor.zonneplan_forecast_tariff_hour_' ~ i %}
            {% if states(sensor_name) != 'unknown' and states(sensor_name) != 'unavailable' %}
              {% set prices = prices + [states(sensor_name)|float(0)] %}
            {% endif %}
          {% endfor %}
          
          {{ prices|length }}
        attributes:
          histogramdata: >
            {% set prices = [] %}
            {% set current_price = states('sensor.zonneplan_current_electricity_tariff')|float(0) %}
            {% set prices = prices + [current_price] %}
            
            {% for i in range(1, 9) %}
              {% set sensor_name = 'sensor.zonneplan_forecast_tariff_hour_' ~ i %}
              {% if states(sensor_name) != 'unknown' and states(sensor_name) != 'unavailable' %}
                {% set prices = prices + [states(sensor_name)|float(0)] %}
              {% endif %}
            {% endfor %}
            
            {% if prices|length > 0 %}
              {% set zeer_laag_count = 0 %}
              {% set laag_count = 0 %}
              {% set gemiddeld_count = 0 %}
              {% set hoog_count = 0 %}
              {% set zeer_hoog_count = 0 %}
              
              {% for price in prices %}
                {% if 0 <= price < 0.15 %}
                  {% set zeer_laag_count = zeer_laag_count + 1 %}
                {% elif 0.15 <= price < 0.20 %}
                  {% set laag_count = laag_count + 1 %}
                {% elif 0.20 <= price < 0.25 %}
                  {% set gemiddeld_count = gemiddeld_count + 1 %}
                {% elif 0.25 <= price < 0.30 %}
                  {% set hoog_count = hoog_count + 1 %}
                {% elif price >= 0.30 %}
                  {% set zeer_hoog_count = zeer_hoog_count + 1 %}
                {% endif %}
              {% endfor %}
              
              [
                {"name": "Zeer Laag", "count": {{ zeer_laag_count }}, "percentage": {{ ((zeer_laag_count / prices|length * 100)|round)|int }}},
                {"name": "Laag", "count": {{ laag_count }}, "percentage": {{ ((laag_count / prices|length * 100)|round)|int }}},
                {"name": "Gemiddeld", "count": {{ gemiddeld_count }}, "percentage": {{ ((gemiddeld_count / prices|length * 100)|round)|int }}},
                {"name": "Hoog", "count": {{ hoog_count }}, "percentage": {{ ((hoog_count / prices|length * 100)|round)|int }}},
                {"name": "Zeer Hoog", "count": {{ zeer_hoog_count }}, "percentage": {{ ((zeer_hoog_count / prices|length * 100)|round)|int }}}
              ]
            {% else %}
              []
            {% endif %}